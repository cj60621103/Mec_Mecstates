<?phpclass Mec_Mecstates_AjaxController extends Mage_Core_Controller_Front_Action{	public function checkCityAction()	{		$region_id = $this->getRequest()->getParam('region_id');		$region_code = Mage::getModel('directory/region')->load($region_id)->getCode();				$citys_array = array();		$html = '';		$collection = Mage::getModel('mecstates/city')->getCollection()					  ->addFieldToFilter('region_code', array('eq' => $region_code));			foreach($collection as $city){			$citys_array[$city->getId()] = $city->getCity();		}				if(count($citys_array) > 0){			$html .= "<option value=''></option>";			foreach($citys_array as $id => $_city){				$html .= "<option value='" . $id."'>" . $_city . "</option>";			}					}		$response['html'] = $html;		$this->getResponse()->setBody(Zend_Json::encode($response));	}		public function checkAreaAction()	{		$city_id = $this->getRequest()->getParam('city_id');		$area_array = array();		$collection = Mage::getModel('mecstates/area')->getCollection()					  ->addFieldToFilter('city_id', array('eq' => $city_id));		foreach($collection as $area){			$area_array[$area->getDistrict()] = $area->getDistrict();		}			  		$html = "";		if(count($area_array) > 0){			$html .= "<option value=''></option>";			foreach($area_array as $area){				$html .= "<option value='" . $area."'>" . $area . "</option>";			}				}		$response['html'] = $html;		$this->getResponse()->setBody(Zend_Json::encode($response));	}			public function initAreaAction()	{		$html = "";		$area_name = $this->getRequest()->getParam('area_name');		$city_id = Mage::getModel('mecstates/area')->loadByField('district', $area_name)->getCityId();		$area_array = array();		$collection = Mage::getModel('mecstates/area')->getCollection()					  ->addFieldToFilter('city_id', array('eq' => $city_id));					  		foreach($collection as $area){			$area_array[$area->getDistrict()] = $area->getDistrict();		}				  						$html .= "<option value=''></option>";		foreach($area_array as $area){			$html .= "<option value='" . $area."'>" . $area . "</option>";		}								$response['html'] = $html;		$this->getResponse()->setBody(Zend_Json::encode($response));	}			public function initCityAction()	{		$_update = false;		$city_name = $this->getRequest()->getParam('city_name');		$count_size = Mage::getModel('mecstates/city')->getCollection()					  ->addFieldToFilter('city', array('eq' => $city_name));				if($count_size->getSize() > 0){			$_update = true;			foreach($count_size as $_city){				$region_code = $_city->getRegionCode();			}						$citys_array = array();			$html = '';			$collection = Mage::getModel('mecstates/city')->getCollection()						  ->addFieldToFilter('region_code', array('eq' => $region_code));									foreach($collection as $city){				$citys_array[$city->getId()] = $city->getCity();			}						if(count($citys_array) > 0){				$html .= "<option value=''></option>";				foreach($citys_array as $id => $_city){					$html .= "<option value='" . $id."'>" . $_city . "</option>";				}						}			$response['update'] = $_update;			$response['html'] = $html;					}else{			$response['update'] = $_update;		}		$this->getResponse()->setBody(Zend_Json::encode($response));			}}